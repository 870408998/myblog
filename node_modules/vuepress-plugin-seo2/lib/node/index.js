import{chalk as S,fs as w}from"@vuepress/utils";import{Logger as R,isAbsoluteUrl as y,isUrl as D,getAuthor as P,getDate as _,stripTags as F}from"vuepress-shared/node";import M from"gray-matter";import{isLinkHttp as q,removeEndingSlash as O,removeLeadingSlash as W}from"@vuepress/shared";const p=new R("vuepress-plugin-seo2"),E=(e,t)=>Object.entries(t).map(([a,n])=>({localePath:a,lang:n.lang})).filter(a=>typeof a.lang=="string"&&a.lang!==e),T=({frontmatter:e},{hostname:t},{options:{base:a}})=>{const{banner:n,cover:r}=e;if(n){if(y(n))return $(t,a,n);if(D(n))return n}if(r){if(y(r))return $(t,a,r);if(D(r))return r}return null},j=({content:e},{hostname:t},{options:{base:a}})=>{const n=/!\[.*?\]\((.*?)\)/giu.exec(e);return n?n.map(([,r])=>y(r)?$(t,a,r):D(r)?r:null).filter(r=>r!==null):[]},$=(e,t,a)=>`${q(e)?O(e):`https://${O(e)}`}${t}${W(a)}`,z=(e="")=>e.replace(/<\/?.+?\/?>/g,""),K=e=>e?z(M(e).content).replace(/!\[(.*?)\]\(.*?\)/gm,"").replace(/```([\s\S]*?)```/g,"").replace(/^\s*:::\s*$/gm,"").replace(/^\s*:::\s*(.+?)(?:\s+(.*))?$/gm,"$2").replace(/^# (.*)$/gm,"$1").replace(/^#{1,6} (.*)$/gm,"$1").replace(/^\s*[-*+] (.*)$/gm,"$1; ").replace(/^\s*>+(.*)$/gm,'"$1"').replace(/(^|[^\\])\[(.*?)\]\(.*?\)/gm,"$1$2").replace(/`{1,2}([^`])(.*?)`{1,2}/g,"$1$2").replace(/~~(.*?)~~/g,"").replace(/(^|[^\\])([*|_]{1,2})(.*?)([^\\])\2/gm,"$1$3$4").replace(/<\/?.+?\/?>/g,"").split(`
`).map(t=>t.trim()).join(`
`).replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim():"",C=(e,t,a="",n="")=>{t in e&&(p.error(`"${S.magenta(t)}" is ${S.red("removed")}${n?`, please use ${S.magenta(n)} instead.`:" and no longer supported"}${a?`
${a}`:""}`),n||delete e[t])},Q=e=>{C(e,"seo","","ogp"),C(e,"customMeta","","customHead")},V=(e,t,a)=>{var n,r,o;const{isArticle:l=c=>Boolean(c.filePathRelative&&!c.frontmatter.home)}=t,{options:{base:u},siteData:s}=a,{frontmatter:{author:g,time:v,date:m=v,tag:d,tags:f=d},data:{git:h={}}}=e,i=((n=s.locales[e.pathLocale])==null?void 0:n.title)||s.title||((r=s.locales["/"])==null?void 0:r.title)||"",B=g===!1?[]:P(g||t.author),{updatedTime:x}=h,I=x?new Date(x).toISOString():"",G=Array.isArray(f)?f:typeof d=="string"?[d]:[],k=e.title,H=T(e,t,a),N=j(e,t,a),J=E(e.lang,s.locales);let b="";if(m instanceof Date)b=new Date(m).toISOString();else if(m){const c=_(m);c&&c.value&&(b=c.value.toISOString())}const A=H||N[0]||t.fallBackImage||"";return{"og:url":$(t.hostname,u,e.path),"og:site_name":i,"og:title":k,"og:description":e.frontmatter.description||t.autoDescription&&e.frontmatter.summary||"","og:type":l(e)?"article":"website","og:image":A,"og:updated_time":I,"og:locale":e.lang,"og:locale:alternate":J.map(({lang:c})=>c),...t.restrictions?{"og:restrictions:age":t.restrictions}:{},...t.twitterID?{"twitter:creator":t.twitterID}:{},...A?{"twitter:card":"summary_large_image","twitter:image:alt":k}:{},"article:author":(o=B[0])==null?void 0:o.name,"article:tag":G,"article:published_time":b,"article:modified_time":I}},X=(e,t,a)=>{const{isArticle:n=i=>Boolean(i.filePathRelative&&!i.frontmatter.home)}=t,{frontmatter:{author:r,time:o,date:l=o},data:{git:u={}}}=e,s=r===!1?[]:P(r||t.author),{updatedTime:g}=u,v=g?new Date(g).toISOString():"",m=e.title,d=T(e,t,a),f=j(e,t,a);let h="";if(l instanceof Date)h=new Date(l).toISOString();else if(l){const i=_(l);i&&i.value&&(h=i.value.toISOString())}return n(e)?{"@context":"https://schema.org","@type":"NewsArticle",headline:m,image:f.length?f:[d||t.fallBackImage||""],datePublished:h,dateModified:v,author:s.map(i=>({"@type":"Person",...i}))}:null},Y=(e,t)=>typeof t.canonical=="function"?t.canonical(e):typeof t.canonical=="string"?`${O(t.canonical)}${e.path}`:null,Z=(e,{hostname:t},{options:a,siteData:n})=>E(e.lang,n.locales).map(({lang:r,localePath:o})=>({lang:r,path:$(t,a.base,`${o}${e.path.replace(e.pathLocale,"")}`)})),L=(e,{name:t,content:a,attribute:n=["article:","og:"].some(r=>t.startsWith(r))?"property":"name"})=>{a&&e.push(["meta",{[n]:t,content:a}])},ee=(e,t)=>{for(const a in t)switch(a){case"article:tag":t["article:tag"].forEach(n=>L(e,{name:"article:tag",content:n}));break;case"og:locale:alternate":t["og:locale:alternate"].forEach(n=>{n!==t["og:locale"]&&L(e,{name:"og:locale:alternate",content:n})});break;default:t[a]&&L(e,{name:a,content:t[a]})}},te=(e,t)=>{t&&e.push(["script",{type:"application/ld+json"},JSON.stringify(t)])},ae=(e,t)=>{t&&e.push(["link",{rel:"canonical",href:t}])},ne=(e,t)=>{t.forEach(({lang:a,path:n})=>{e.push(["link",{rel:"alternate",hreflang:a.toLowerCase(),href:n}])})},re=(e,t,a)=>{const n=e.frontmatter.head||[],r=V(e,t,a),o=X(e,t,a),l=t.ogp?t.ogp(r,e,a):r,u=t.jsonLd?t.jsonLd(o,e,a):null,s=Y(e,t),g=Z(e,t,a);ee(n,l),te(n,u),ae(n,s),ne(n,g),t.customHead&&t.customHead(n,e,a),e.frontmatter.head=n},oe=async e=>{p.load("Generating robots.txt");const t=e.public("robots.txt");let a=w.existsSync(t)?await w.readFile(t,{encoding:"utf8"}):"";a&&!a.includes("User-agent")?(p.error(),p.update("robots.txt seems invalid!")):(a+=`
User-agent:*
Disallow:
`,await w.writeFile(e.dest("robots.txt"),a,{flag:"w"}),p.succeed())},U=(e,t=!1)=>a=>{t&&Q(e),a.env.isDebug&&p.info(`Options: ${e.toString()}`);const n={name:"vuepress-plugin-seo2"};return e.hostname?{...n,extendsPage:(r,o)=>{r.frontmatter.description||(r.frontmatter.summary=F(r.excerpt)||K(r.content).slice(0,180)||""),re(r,e,o)},onGenerated:r=>oe(r.dir)}:(p.error(`Option ${S.magenta("hostname")} is required!`),n)};export{U as default,U as seoPlugin};
//# sourceMappingURL=index.js.map
